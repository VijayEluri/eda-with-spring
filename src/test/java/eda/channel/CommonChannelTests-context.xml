<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:file="http://www.springframework.org/schema/integration/file"
	xmlns:groovy="http://www.springframework.org/schema/integration/groovy"
	xmlns:jms="http://www.springframework.org/schema/integration/jms"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-2.0.xsd
		http://www.springframework.org/schema/integration/file http://www.springframework.org/schema/integration/file/spring-integration-file-2.0.xsd
		http://www.springframework.org/schema/integration/groovy http://www.springframework.org/schema/integration/groovy/spring-integration-groovy-2.0.xsd
		http://www.springframework.org/schema/integration/jms http://www.springframework.org/schema/integration/jms/spring-integration-jms-2.0.xsd
		http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	<publish-subscribe-channel id="messagesIn"/>

	<message-history/>

	<service-activator id="exampleService" input-channel="messagesIn">
		<groovy:script location="eda/channel/ExampleService.groovy" refresh-check-delay="10000"/>
		<!-- <beans:bean class="eda.channel.ExampleService"/>-->
	</service-activator>

	<jms:message-driven-channel-adapter id="jmsIn" destination-name="queue.example.common" channel="messagesIn"/>

	<file:inbound-channel-adapter id="filesIn" directory="${java.io.tmpdir}/eda-common-channel" channel="filesChannel">
		<poller fixed-delay="5000"/>
	</file:inbound-channel-adapter>

	<file:file-to-string-transformer id="filesToString" input-channel="filesChannel" output-channel="messagesIn"/>

	<scheduled-producer fixed-delay="10000" channel="jmsOut"
			payload-expression="@jmsTemplate.convertAndSend('JMS Message at ' + new java.util.Date())"/>

	<jms:outbound-channel-adapter id="jmsOut" destination-name="queue.example.common"/>

	<beans:bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate"
		p:connectionFactory-ref="connectionFactory"
		p:defaultDestinationName="queue.example.common"/>

	<beans:bean id="connectionFactory" class="org.springframework.jms.connection.CachingConnectionFactory"
		p:sessionCacheSize="10">
		<beans:property name="targetConnectionFactory">
			<beans:bean class="org.apache.activemq.ActiveMQConnectionFactory" p:brokerURL="vm://localhost"/>
		</beans:property>
	</beans:bean>

	<context:property-placeholder/>

</beans:beans>